name: CI
permissions: {}

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  TURBO_TOKEN: ${{ secrets.TURBO_TOKEN }}
  TURBO_TEAM: ${{ vars.TURBO_TEAM }}
  SENTRY_AUTH_TOKEN: ${{ secrets.SENTRY_AUTH_TOKEN }}

jobs:
  static-analysis:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Check out repository code
        uses: actions/checkout@v4

      - name: Setup Node.js & install dependencies
        uses: ./.github/actions/setup-deps

      - run: git fetch --update-head-ok --depth 200 origin test-ci:test-ci
      - run: git fetch --update-head-ok --depth 200 origin main:main
      - run: git merge-base test-ci main
      - run: git fetch --depth=200 origin ${{ github.sha }}
      - run: git log --format="%H" --max-count=200 ${{ github.sha }}
